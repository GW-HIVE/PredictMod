!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lodash/merge"),require("vue"),require("lodash/drop"),require("lodash/every"),require("lodash/forEach"),require("lodash/get"),require("lodash/isArray"),require("lodash/map"),require("lodash/set"),require("papaparse"),require("lodash/findKey"),require("axios")):"function"==typeof define&&define.amd?define(["exports","lodash/merge","vue","lodash/drop","lodash/every","lodash/forEach","lodash/get","lodash/isArray","lodash/map","lodash/set","papaparse","lodash/findKey","axios"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["vue-csv-import"]={},e.merge,e.vue,e.drop,e.every,e.forEach,e.get,e.isArray,e.map,e.set,e.Papa,e.findKey,e.axios)}(this,(function(e,t,a,l,r,o,s,n,u,i,p,c,d){"use strict";function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var v=m(t),f=m(l),g=m(r),C=m(o),b=m(s),h=m(n),y=m(u),V=m(i),k=m(p),D=m(c),S=m(d);const B={errors:{fileRequired:"A file is required",invalidMimeType:"Invalid file type"},toggleHeaders:"File has headers",submitBtn:"Submit",fieldColumn:"Field",csvColumn:"Column",requiredField:"*",excludeField:"Exclude field"};var I={props:{modelValue:Array,fields:{type:[Object,Array],required:!0},text:{default:()=>({})}},setup(e,{emit:t}){let l=a.reactive({errors:[],inputName:"csv",file:null,map:{},value:{},fields:(r=e.fields,h.default(r)?y.default(r,(e=>({key:e,label:e,required:!0}))):y.default(r,((e,t)=>({key:t,label:b.default(e,"label",e),required:b.default(e,"required",!0)})))),fileHasHeaders:null,csvSample:null,rawCsv:null,language:v.default({},B,e.text),firstSampleRow:a.computed((()=>h.default(l.csvSample)&&h.default(l.csvSample[0])?l.csvSample[0]:null)),allFieldsAreMapped:a.computed((()=>g.default(l.fields,(function(e){return void 0!==l.map[e.key]||!e.required}))))});var r;return a.provide("VueCsvImportData",l),a.provide("buildMappedCsv",(function(){let e=l.fileHasHeaders?l.rawCsv:f.default(l.rawCsv);l.value=y.default(e,(e=>{let t={};return C.default(l.map,((a,l)=>{V.default(t,l,b.default(e,a))})),t})),t("update:modelValue",l.value)})),{VueCsvImportData:l}}};I.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"default",{errors:r.VueCsvImportData.errors,fields:r.VueCsvImportData.fields,file:r.VueCsvImportData.file})},I.__file="src/components/VueCsvImport.vue";var x={name:"VueCsvFiles",setup:()=>({VueCsvImportData:a.inject("VueCsvImportData")})};x.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"default",{errors:r.VueCsvImportData.errors.value},(()=>[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(r.VueCsvImportData.errors,(t=>(a.openBlock(),a.createBlock("span",e.$attrs,a.toDisplayString(t),17)))),256))]))},x.__file="src/components/VueCsvErrors.vue";const M={"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]}};var H={name:"CsvFile",props:{name:{type:String,default:"csv"},headers:{type:[Boolean,null],default:!0},parseConfig:{type:Object,default:()=>({})},validation:{type:Boolean,default:!0},fileMimeTypes:{type:Array,default:()=>["text/csv","text/x-csv","application/vnd.ms-excel","text/plain"]}},setup(e){const t=a.ref(null),l=a.inject("VueCsvImportData"),r=a.inject("buildMappedCsv"),o=l.language;l.inputName=name,l.fileHasHeaders=null!==e.headers?!!e.headers:null;const s=function(t){if(l.errors=[],t||l.errors.push(o.errors.fileRequired),e.validation){const a=""===t.type?function(e){if(!e||"string"!=typeof e)return!1;let t=e.split(".").pop();return t&&D.default(M,(e=>e.extensions.includes(t)))||!1}(t.name):t.type;return e.fileMimeTypes.includes(a)||l.errors.push(o.errors.invalidMimeType),0===l.errors.length}return!0};return a.watch((()=>l.file),(t=>{t||(l.csvSample.value=null,l.rawCsv.value=null);let a=new FileReader;a.readAsText(l.file,e.parseConfig.encoding||"UTF-8"),a.onload=function(t){l.csvSample=b.default(k.default.parse(t.target.result,v.default({preview:10,skipEmptyLines:!0},e.parseConfig)),"data"),l.rawCsv=b.default(k.default.parse(t.target.result,v.default({skipEmptyLines:!0},e.parseConfig)),"data")},a.onerror=function(e){console.log(e)}}),{deep:!0}),a.watch((()=>l.fileHasHeaders),(()=>{l.allFieldsAreMapped&&r()})),{file:l.file,change:function(){let e=t.value.files?t.value.files[0]:null;s(e)&&(l.file=e)},csvRef:t}}};H.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"default",{file:r.file,change:r.change},(()=>[a.createVNode("input",a.mergeProps({ref:"csvRef",type:"file",onChange:t[1]||(t[1]=(...e)=>r.change&&r.change(...e)),name:l.name},e.$attrs),null,16,["name"])]))},H.__file="src/components/VueCsvInput.vue";var w={name:"CsvMap",props:{noThead:{type:Boolean,default:!1},selectAttributes:{type:Object,default:()=>({})},autoMatch:{type:Boolean,default:!0},autoMatchIgnoreCase:{type:Boolean,default:!0}},setup(e){const t=a.inject("VueCsvImportData"),l=a.inject("buildMappedCsv"),r=t.language;return a.watch((()=>t.map),(function(){t.allFieldsAreMapped&&l()}),{deep:!0}),e.autoMatch&&a.watch((()=>t.csvSample),(function(a){a&&t.fields.forEach((l=>{a[0].forEach(((a,r)=>{(e.autoMatchIgnoreCase?l.label.toLowerCase().trim():l.label.trim())===(e.autoMatchIgnoreCase?a.toLowerCase().trim():a.trim())&&(t.map[l.key]=r)}))}))})),{VueCsvImportData:t,labels:r}}};const q={key:0},N={key:0,value:null};w.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"default",{sample:r.VueCsvImportData.firstSampleRow,map:r.VueCsvImportData.map,fields:r.VueCsvImportData.fields},(()=>[r.VueCsvImportData.firstSampleRow?(a.openBlock(),a.createBlock("table",a.mergeProps({key:0},e.$attrs),[l.noThead?a.createCommentVNode("v-if",!0):(a.openBlock(),a.createBlock("thead",q,[a.createVNode("tr",null,[a.createVNode("th",null,a.toDisplayString(r.labels.fieldColumn),1),a.createVNode("th",null,a.toDisplayString(r.labels.csvColumn),1)])])),a.createVNode("tbody",null,[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(r.VueCsvImportData.fields,((e,t)=>(a.openBlock(),a.createBlock("tr",{key:t},[a.createVNode("td",null,a.toDisplayString(e.label),1),a.createVNode("td",null,[a.withDirectives(a.createVNode("select",a.mergeProps(l.selectAttributes,{name:`csv_uploader_map_${t}`,"onUpdate:modelValue":t=>r.VueCsvImportData.map[e.key]=t}),[e.required?a.createCommentVNode("v-if",!0):(a.openBlock(),a.createBlock("option",N,"Â ")),(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(r.VueCsvImportData.firstSampleRow,((e,t)=>(a.openBlock(),a.createBlock("option",{key:t,value:t},a.toDisplayString(e),9,["value"])))),128))],16,["name","onUpdate:modelValue"]),[[a.vModelSelect,r.VueCsvImportData.map[e.key]]])])])))),128))])],16)):a.createCommentVNode("v-if",!0)]))},w.__file="src/components/VueCsvMap.vue";var F={name:"CsvTableMap",props:{tableAttributes:{type:Object,default:()=>({})},autoMatch:{type:Boolean,default:!0},autoMatchIgnoreCase:{type:Boolean,default:!0}},setup(e){const t=a.inject("VueCsvImportData"),l=a.inject("buildMappedCsv"),r=t.language,o=a.reactive({}),s=a.computed((()=>t.fields.map((e=>(e.selected=Object.values(o).includes(e.label),e)))));a.watch((()=>o),(function(){t.map={};for(const[e,a]of Object.entries(o))""!==a&&(t.map[a.toLowerCase()]=e);t.allFieldsAreMapped&&l()}),{deep:!0});const n=a.computed((()=>t.fileHasHeaders?t.csvSample:t.csvSample.slice(1))),u=a.computed((()=>t.fileHasHeaders?[...Array(t.firstSampleRow.length).keys()].map((e=>`${r.csvColumn} ${e}`)):t.firstSampleRow));return e.autoMatch&&a.watch((()=>t.csvSample),(function(a){a&&t.fields.forEach((t=>{a[0].forEach(((a,l)=>{(e.autoMatchIgnoreCase?t.label.toLowerCase().trim():t.label.trim())===(e.autoMatchIgnoreCase?a.toLowerCase().trim():a.trim())&&(o[l]=t.label)}))}))})),{availableFields:s,csvMap:o,csvSample:n,headers:u,VueCsvImportData:t,labels:r}}};const _={value:""};F.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"default",{sample:r.VueCsvImportData.firstSampleRow,map:r.VueCsvImportData.map,fields:r.VueCsvImportData.fields},(()=>[r.VueCsvImportData.firstSampleRow?(a.openBlock(),a.createBlock("table",a.mergeProps({key:0},l.tableAttributes),[a.createVNode("thead",null,[a.createVNode("tr",null,[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(r.headers,((e,t)=>(a.openBlock(),a.createBlock("td",{key:e},[a.createTextVNode(a.toDisplayString(e)+" ",1),a.withDirectives(a.createVNode("select",{"onUpdate:modelValue":e=>r.csvMap[t]=e,name:`csv_uploader_map_${t}`,required:""},[a.createVNode("option",_,a.toDisplayString(r.labels.excludeField),1),(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(r.availableFields,(e=>(a.openBlock(),a.createBlock("option",{value:e.label,key:e.key,disabled:e.selected},a.toDisplayString(e.label)+a.toDisplayString(e.required?r.labels.requiredField:""),9,["value","disabled"])))),128)),r.VueCsvImportData.fields.map((e=>e.label)).includes(e)?a.createCommentVNode("v-if",!0):(a.openBlock(),a.createBlock("option",{value:e,key:e},a.toDisplayString(e),9,["value"]))],8,["onUpdate:modelValue","name"]),[[a.vModelSelect,r.csvMap[t]]])])))),128))])]),a.createVNode("tbody",null,[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(r.csvSample,(e=>(a.openBlock(),a.createBlock("tr",null,[(a.openBlock(!0),a.createBlock(a.Fragment,null,a.renderList(e,(e=>(a.openBlock(),a.createBlock("td",null,a.toDisplayString(e),1)))),256))])))),256))])],16)):a.createCommentVNode("v-if",!0)]))},F.__file="src/components/VueCsvTableMap.vue";var A={name:"VueCsvImportSubmit",props:{url:{type:String,required:!0},config:{type:Object,required:!1,default:{}}},setup(e){const t=a.inject("VueCsvImportData"),l=a.inject("buildMappedCsv"),r=t.language;return{submit:function(){l(),S.default.post(e.url,{[t.inputName]:t.value},e.config).then((e=>{emit("send-success",e)})).catch((e=>{emit("send-error",e)})).finally((e=>{emit("send-complete",e)}))},VueCsvImportData:t,labels:r}}};A.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"submit",{submit:r.submit,mappedCsv:r.VueCsvImportData.value},(()=>[a.createVNode("button",a.mergeProps({type:"submit"},e.$attrs,{onClick:t[1]||(t[1]=a.withModifiers(((...e)=>r.submit&&r.submit(...e)),["prevent"]))}),a.toDisplayString(r.labels.submitBtn),17)]))},A.__file="src/components/VueCsvSubmit.vue";var j={name:"ToggleHasHeaders",props:{labelAttributes:{},checkboxAttributes:{}},setup(){const e=a.inject("VueCsvImportData"),t=e.language;return{VueCsvImportData:e,toggleHasHeaders:function(){e.fileHasHeaders=!e.fileHasHeaders},labels:t}}};j.render=function(e,t,l,r,o,s){return a.renderSlot(e.$slots,"default",{hasHeaders:r.VueCsvImportData.fileHasHeaders,toggle:r.toggleHasHeaders},(()=>[a.createVNode("label",l.labelAttributes,[a.createVNode("input",a.mergeProps({type:"checkbox"},l.checkboxAttributes,{value:r.VueCsvImportData.fileHasHeaders,onChange:t[1]||(t[1]=(...e)=>r.toggleHasHeaders&&r.toggleHasHeaders(...e))}),null,16,["value"]),a.createTextVNode(" "+a.toDisplayString(r.labels.toggleHeaders),1)],16)]))},j.__file="src/components/VueCsvToggleHeaders.vue";const T={install(e,t){t=v.default({components:{"vue-csv-import":"vue-csv-import","vue-csv-errors":"vue-csv-errors","vue-csv-input":"vue-csv-input","vue-csv-map":"vue-csv-map","vue-csv-table-map":"vue-csv-table-map","vue-csv-submit":"vue-csv-submit","vue-csv-toggle-headers":"vue-csv-toggle-headers"}},t),e.component(t.components["vue-csv-import"],I),e.component(t.components["vue-csv-errors"],x),e.component(t.components["vue-csv-input"],H),e.component(t.components["vue-csv-map"],w),e.component(t.components["vue-csv-table-map"],F),e.component(t.components["vue-csv-submit"],A),e.component(t.components["vue-csv-toggle-headers"],j)}};e.VueCsvErrors=x,e.VueCsvImport=I,e.VueCsvImportPlugin=T,e.VueCsvInput=H,e.VueCsvMap=w,e.VueCsvSubmit=A,e.VueCsvTableMap=F,e.VueCsvToggleHeaders=j,Object.defineProperty(e,"__esModule",{value:!0})}));
